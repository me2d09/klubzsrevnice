---
sitemap:
  exclude: 'yes'
---
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
{% assign past_posts = site.posts | where_exp: "post", "post.date < site.time" %}
  {% for post in past_posts %}
    {%- unless post.published == false -%}
    <url>
      <loc>{{ site.url }}{{ post.url }}</loc>
      {% if post.sitemap.lastmod %}
        <lastmod>{{ post.sitemap.lastmod | date: "%Y-%m-%d" }}</lastmod>
      {%- elsif post.date -%}
        <lastmod>{{ post.date | date_to_xmlschema }}</lastmod>
      {%- else -%}
        <lastmod>{{ site.time | date_to_xmlschema }}</lastmod>
      {% endif %}
      {% if post.sitemap.changefreq %}
        <changefreq>{{ post.sitemap.changefreq }}</changefreq>
      {%- else -%}
        <changefreq>never</changefreq>
      {% endif %}
      {%- if post.sitemap.priority -%}
        <priority>{{ post.sitemap.priority }}</priority>
      {%- else -%}
        <priority>0.8</priority>
    {%- endif- %}
    </url>
    {%- endunless %}
  {% endfor %}
  {% for page in site.pages %}
    {%- assign split_path = page.path | split: "." -%}
    {%- assign extension = split_path | last -%}
    {% if page.sitemap.exclude != true and extension != "xml" and page.path != "404.html" %}
    <url>
      <loc>{{ site.url }}{{ page.url | remove: "index.html" }}</loc>
      {% if page.sitemap.lastmod %}
        <lastmod>{{ page.sitemap.lastmod | date: "%Y-%m-%d" }}</lastmod>
      {% elsif page.date %}
        <lastmod>{{ page.date | date_to_xmlschema }}</lastmod>
      {%- else -%}
        <lastmod>{{ site.time | date_to_xmlschema }}</lastmod>
      {% endif %}
      {%- if page.sitemap.changefreq -%}
        <changefreq>{{ page.sitemap.changefreq }}</changefreq>
      {%- else -%}
        <changefreq>weekly</changefreq>
      {% endif %}
      {%- if page.sitemap.priority -%}
        <priority>{{ page.sitemap.priority }}</priority>
      {%- else -%}
        <priority>0.6</priority>
      {%- endif %}
    </url>
    {%- endif -%}
  {% endfor %}

  {% for collection in site.collections %}
  {% if collection.output and collection.label != "posts" %}
    {% for doc in collection.docs %}
    <url>
        <loc>{{ site.url }}{{ doc.url | remove: "index.html" }}</loc>
        {% if doc.sitemap.lastmod -%}
        <lastmod>{{ doc.sitemap.lastmod | date: "%Y-%m-%d" }}</lastmod>
        {%- elsif doc.date -%}
        <lastmod>{{ doc.date | date_to_xmlschema }}</lastmod>
        {%- else -%}
        <lastmod>{{ site.time | date_to_xmlschema }}</lastmod>
        {%- endif %}
        {% if doc.sitemap.changefreq -%}
        <changefreq>{{ doc.sitemap.changefreq }}</changefreq>
        {% elsif collection.sitemap.changefreq -%}
        <changefreq>{{ collection.sitemap.changefreq }}</changefreq>
        {%- else -%}
        <changefreq>weekly</changefreq>
        {% endif %}{% if doc.sitemap.priority %}
        <priority>{{ doc.sitemap.priority }}</priority>
        {%- else -%}
        <priority>0.3</priority>
        {%- endif %}
    </url>
    {%- endfor -%}
    {% endif %}
  {% endfor %}
</urlset>